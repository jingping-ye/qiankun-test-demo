# 主项目搭建与配置

1. 安装`qiankun`

```js
npm i qiankun -S
```

2. 新建`main/src/microApps.js`文件用声明子应用。

```js
let microApps = [
  {
    name: 'sub-vue',
    entry: '//localhost:7777/',
    activeRule: '/sub-vue',
  },
  {
    name: 'sub-react',
    entry: '//localhost:7788/',
    activeRule: '/sub-react',
  }
]

microApps = microApps.map((item) => {
  return {
    ...item,
    container: "#subapp-viewport",
    props: {
      routerBase: item.activeRule,
    },
  };
});

export default microApps
```

3. 在`main.js`中对子应用进行注册。

```js
import Vue from "vue";
import App from "./App.vue";
import router from "./router";
import store from "./store";
import microApps from "./microApps";
import { registerMicroApps, start } from "qiankun";

Vue.config.productionTip = false;

new Vue({
  router,
  store,
  render: (h) => h(App),
}).$mount("#app");


registerMicroApps(microApps, {
  beforeLoad: (app) => {
    console.log("before load app.name====>>>>>", app.name);
  },
  beforeMount: [
    (app) => {
      console.log("[LifeCycle] before mount %c%s", "color: green;", app.name);
    },
  ],
  afterMount: [
    (app) => {
      console.log("[LifeCycle] after mount %c%s", "color: green;", app.name);
    },
  ],
  afterUnmount: [
    (app) => {
      console.log("[LifeCycle] after unmount %c%s", "color: green;", app.name);
    },
  ],
});

start();
```

4. 修改应用挂载的DOM节点，防止与其他应用挂载节点冲突，这里我们将挂载节点声明为`root-app`。

（1）修改`public/index.html`文件。

````html
    <div id="root-app"></div>
````

（2）修改`main.js`文件

```js
new Vue({
  router,
  store,
  render: (h) => h(App),
}).$mount("#root-app");
```

（3）修改`App.vue`文件。

```js
<template>
  <div id="root-app">
    <div id="nav">
      <router-link to="/">Home</router-link> |
      <router-link to="/about">About</router-link>
    </div>
    <router-view />
  </div>
</template>
```

5. 在`App.vue`中新增一个节点用于挂载子应用。

```js
<template>
  <div id="root-app">
    <div id="nav">
      <router-link to="/">Home</router-link> |
      <router-link to="/about">About</router-link>
    </div>
    <router-view />
    <div id="subapp-viewport"></div>
  </div>
</template>
```

6. 修改路由为历史模式

```js
// src/router/index.js
const router = new VueRouter({
  mode: "history",
  routes,
});
```

7. 运行应用进行测试。此时，应用应该正常运行。

```bash
npm run serve
```



