# 如何注册微应用

1. 在主应用中声明一个`microApps.js`文件用于管理微应用基本信息。

```js
const microApps = [
    {
        name:"sub-vue", 
        entry:"//localhost:7777/",
        activeRule:"/sub-vue"
    }
];

export default microApps;
```

- name：微应用名称，应该与微应用的`package.json`文件中的`name`保持一致。
- entry：微应用的入口
  - 配置为字符串时，表示微应用的访问地址。
  - 配置为对象时，`html`的值是微应用的html内容字符串。
- `activeRule`：微应用的激活规则，也是要进行下发基础路由。
  - 支持直接配置字符串或者字符串数组。当配置为字符串时会直接跟url中路径部分做前缀匹配，匹配成功则表明当前应用被激活。
  - 支持配置一个 active function 函数或一组 active function。函数会传入当前 location 作为参数，函数返回 true 时表明当前微应用会被激活。如 `location => location.pathname.startsWith('/app1')`。

2. 在`main.js`中注册

```js
import {registerMicroApps, start} from 'quankun';
import microApps from './microApps';

const apps = microApps.map(item=>{
    return {
        ...item,
       	container:"#subapp-viewport",
        props:{
            routerBase:item.activeRule,
        }
    }
})
registerMicroApps(app, {
    beforeLoad: app => console.log('before load', app.name),
    beforeMount: [
      app => console.log('before mount', app.name),
    ],
});
```

- container：微应用挂载节点。微应用挂载节点一般是统一的，所以这里在`main.js`中统一声明，如果不一样，可以在基础信息中声明。
- props: 主应用传递给子应用的信息。这里我们将`activeRule`下发，作为子应用的基础路由。
- registerMicroApps的第二个参数是一系列的生命周期。我们可以声明这一系列方法进行观察应用的变化。
  - beforeLoad - `Lifecycle | Array<Lifecycle>` - 可选
  - beforeMount - `Lifecycle | Array<Lifecycle>` - 可选
  - afterMount - `Lifecycle | Array<Lifecycle>` - 可选
  - beforeUnmount - `Lifecycle | Array<Lifecycle>` - 可选
  - afterUnmount - `Lifecycle | Array<Lifecycle>` - 可选